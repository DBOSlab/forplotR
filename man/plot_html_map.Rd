% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_html_map 2.R, R/plot_html_map.R
\name{plot_html_map}
\alias{plot_html_map}
\title{Plot and save vouchered forest plot map as HTML}
\usage{
plot_html_map(fp_file_path = NULL,
                     vertex_coords = NULL,
                     plot_size = 1,
                     subplot_size = 10,
                     voucher_imgs = NULL,
                     filename = "plot_map.html")

plot_html_map(fp_file_path = NULL,
                     input_type = c("field_sheet", "fp_query_sheet", "monitora"),
                     vertex_coords = NULL,
                     plot_size = 1,
                     subplot_size = 10,
                     voucher_imgs = NULL,
                     filename = "plot_map",
                     station_name = NULL,
                     collector = NULL,
                     herbaria_lookup = FALSE,
                     herbaria = NULL,
                     jabot_cache_rds = "jabot_index.rds",
                     jabot_force_refresh = FALSE,
                     comment_email_to = NULL)
}
\arguments{
\item{fp_file_path}{Character. Path to the Excel file containing tree data.}

\item{input_type}{One of \code{"field_sheet"}, \code{"fp_query_sheet"} or
\code{"monitora"}. For \code{"fp_query_sheet"}, the function expects a
ForestPlots Query Library export and converts it internally into a
field-sheet-like table. For \code{"monitora"}, it expects a Maltese-cross
layout.}

\item{vertex_coords}{Data frame, path to an Excel file, or numeric vector.
For \code{"field_sheet"} and \code{"fp_query_sheet"}, provide four plot
corners (Latitude/Longitude). For \code{"monitora"}, provide a single
central Latitude/Longitude used as the cross center. A numeric vector of
length two is interpreted either as \code{c(lat, lon)} or as a named vector
with elements \code{lat}/\code{latitude} and \code{lon}/\code{longitude}.}

\item{plot_size}{Numeric. Total plot size in hectares (default is 1).}

\item{subplot_size}{Numeric. Subplot size in meters (default is 10).}

\item{voucher_imgs}{Character. Directory path where voucher images are stored.
Subdirectories are assumed to be named after voucher IDs, each containing
one or more image files.}

\item{filename}{Character. Base name of the output HTML file (without
extension). The function will prepend a date-stamped prefix and append
\code{".html"} (default is \code{"plot_map"}).}

\item{station_name}{Character or \code{NULL}. For \code{"monitora"} inputs,
optionally filter or loop over one or more station names. When a vector of
station names is given, the function calls itself once per station.}

\item{collector}{Character. Optional fallback collector name used when
compact voucher codes are provided (e.g. \code{"GCO1095"} without an explicit
collector string).}

\item{herbaria_lookup}{Logical. If \code{TRUE}, the function performs a local
herbarium lookup and adds a \code{herbaria_link} column to the specimen data,
building a minimal index from JABOT DwC-A downloads (via \pkg{jabotR}).}

\item{herbaria}{Character vector or \code{NULL}. Herbarium codes to be used
in the herbaria lookup, e.g. \code{c("RB","UPCB")}. When
\code{herbaria_lookup = TRUE} this argument must be a non-empty vector;
by default it is \code{NULL} and no herbaria search is performed unless the
user explicitly supplies the herbarium codes.}

\item{jabot_cache_rds}{Character. Path to an \code{.rds} file used to cache
the JABOT-based index (keys and catalog numbers) between runs. Defaults to
\code{"jabot_index.rds"} in the working directory.}

\item{jabot_force_refresh}{Logical. If \code{TRUE}, forces rebuilding the
JABOT-based index from the local DwC-A archives, ignoring any existing
cache file.}

\item{comment_email_to}{Character or \code{NULL}. Optional e-mail address of
the plot PI. If provided (non-empty), specimen popups include a
\code{"Send comment"} button that opens an EmailJS-powered form inside the
HTML map. All messages are sent using the built-in \pkg{forplotR} EmailJS
configuration.}

\item{comment_email}{Character. Email to receive comments. ## NEW}
}
\description{
Generates an interactive and self-contained HTML map following the
\href{https://forestplots.net/}{ForestPlots plot protocol}, using Leaflet
and based on vouchered tree data and the geographical coordinates of the
plot corners. The function:(i) Converts local subplot coordinates (X, Y) to
geographic coordinates using geospatial interpolation from four corner vertices;
(ii) automatically extracts metadata like team name, plot name, and plot code
from the input xlsx file; (iii) draws the plot boundary polygon with angular
ordering to prevent self-intersection, over a selectable basemap ("satellite"
or "street"); (iv) colors tree points based on collection status and palms:
palms (yellow), collected (gray), and missing (red); (v) embeds image
carousels in the popups for vouchers when corresponding images are available
in the specified folder; (vi) adds an interactive filter sidebar with
checkboxes, multi-select inputs, and search box for filtering by family,
species, collection status, and presence of photos; (vii) displays informative
popups for each tree,showing tag number, subplot,family, species, DBH,
voucher code, and photos; (viii) saves the resulting map as a date-stamped
standalone HTML file with multiple interactive leaflet map options to the
specified directory for easy sharing, archiving, or field consultation.

Generates an interactive and self-contained HTML map for forest plots
following either the \href{https://forestplots.net/}{ForestPlots plot protocol}
or the \href{https://www.gov.br/icmbio/pt-br/assuntos/monitoramento/programa-monitora}
{MONITORA monitoring program}, using Leaflet and based on vouchered tree data
and plot coordinates. The function handles both standard ForestPlots layouts
(1 ha or 0.5 ha plots defined by four corner vertices) and MONITORA 
layouts (Maltese cross design defined by a single central coordinate). 
It: (i) converts local subplot coordinates (X, Y) to geographic coordinates 
using geospatial interpolation from plot vertices or a  central point; 
(ii) extracts metadata such as team name, plot name, and plot code from the 
input file; (iii) draws the plot boundary polygon or Maltese cross arms over
selectable basemaps; (iv) colors tree points by collection status and palms 
(palms = yellow, collected = gray, missing = red); (v) embeds image carousels in
specimen popups when matching voucher images are found in the specified
folder; (vi) optionally performs a local herbarium lookup (e.g. JABOT DwC-A
downloads) to attach direct “Herbarium image” links to each voucher when
available; (vii) adds an interactive filter sidebar with checkboxes,
multi-select inputs, and a search box for filtering by family, species,
collection status, subplot, and presence of photos; (viii) displays
informative popups for each tree, showing tag number, subplot, family,
species, DBH, voucher code, herbarium image link (if found), and photos;
(ix) optionally adds an EmailJS-powered comment form to each specimen popup;
and (x) saves the resulting map as a date-stamped standalone HTML file with
multiple interactive Leaflet map options for easy sharing, archiving, or
field consultation.
}
\examples{
\dontrun{
vertex_df <- data.frame(
  Latitude = c(-3.123, -3.123, -3.125, -3.125),
  Longitude = c(-60.012, -60.010, -60.012, -60.010)
)
plot_html_map("data/tree_data.xlsx",
               vertex_coords = vertex_df,
               voucher_imgs = "voucher_imgs")
}

\dontrun{
vertex_df <- data.frame(
  Latitude  = c(-3.123, -3.123, -3.125, -3.125),
  Longitude = c(-60.012, -60.010, -60.012, -60.010)
)

# Basic example (field_sheet)
plot_html_map(
  fp_file_path  = "data/tree_data.xlsx",
  input_type    = "field_sheet",
  vertex_coords = vertex_df,
  voucher_imgs  = "voucher_imgs",
  filename      = "plot_map"
)

# Example with herbaria lookup
plot_html_map(
  fp_file_path    = "data/RUS_plot.xlsx",
  input_type      = "field_sheet",
  vertex_coords   = "data/vertices.xlsx",
  voucher_imgs    = "voucher_imgs",
  collector       = "G. C. Ottino",
  herbaria_lookup = TRUE,
  herbaria        = c("RB", "UPCB"),
  filename        = "rus_plot_map"
)
}

}
\author{
Giulia Ottino & Domingos Cardoso
}
